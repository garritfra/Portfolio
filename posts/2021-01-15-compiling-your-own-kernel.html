<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width, initial-scale=1"/><meta charSet="utf-8"/><title>Compiling your own kernel | Garrit&#x27;s Notes</title><meta name="Description" content="Generalist developer writing about fullstack development, system administration and free software."/><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/><link rel="manifest" href="/site.webmanifest"/><link rel="webmention" href="https://webmention.io/garrit.xyz/webmention"/><link rel="pingback" href="https://webmention.io/garrit.xyz/xmlrpc"/><meta name="next-head-count" content="10"/><link rel="preload" href="/_next/static/css/0bac3a96f082ebb9.css" as="style" crossorigin=""/><link rel="stylesheet" href="/_next/static/css/0bac3a96f082ebb9.css" crossorigin="" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" crossorigin="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-ee7e63bc15b31913.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/framework-5429a50ba5373c56.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/main-72cd581c1e9bd837.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/pages/_app-1fd99a5127a4dfe2.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/630-7825a1477e4aff6c.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/pages/posts/%5Bpost%5D-8ccc003b4c841e94.js" defer="" crossorigin=""></script><script src="/_next/static/nrrBUjPSWR0mSvEDGN-1p/_buildManifest.js" defer="" crossorigin=""></script><script src="/_next/static/nrrBUjPSWR0mSvEDGN-1p/_ssgManifest.js" defer="" crossorigin=""></script></head><body><div id="__next"><section class="layout"><header class="header"><nav class="nav" role="navigation" aria-label="main navigation"><div class="header__container"><a href="/" class="header__container__logo">Garrit&#x27;s Notes</a></div><ul class="header__links"><li><a href="/posts">Blog</a></li><li><a href="/contact">Contact</a></li><li><a href="/links">More ...</a></li></ul></nav></header><div class="content"><article class="page h-entry"><div class="page__info"><h1 class="p-name">Compiling your own kernel</h1><time class="page__info__date">Jan 15 2021</time><p class="tag-list"><a href="/posts?tags=linux">#<!-- -->linux</a><a href="/posts?tags=guide">#<!-- -->guide</a><a href="/posts?tags=100DaysToOffload">#<!-- -->100DaysToOffload</a><a href="/posts?tags=infrastructure">#<!-- -->infrastructure</a><a href="/posts?tags=tech">#<!-- -->tech</a></p></div><div class="page__body e-content"><p>I&#x27;m currently in the midst of fiddling around with the kernel a bit, and I figured I just documented my process a bit. Unfortunately, since I&#x27;m using a Mac for day to day work, I have to rely on a virtual machine to run anything Linux-related. VirtualBox doesn&#x27;t support the most recent kernels (5.9 is the most recent supported one), so there won&#x27;t be any cutting-edge development happening here. I decided to use ubuntu as my guest system, since it&#x27;s very easy to set up.</p>
<p>So, the first step is to get the sources. You could simply go ahead and download a specific release from <a href="https://kernel.org/">kernel.org</a>, but since I want to hack on it, I decided to go the git-route. Simply download the sources from <a href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/">their repo</a> and check out the tag you want to build.</p>
<blockquote>
<p><strong>Note</strong>: this might take a while. Their repository is huge! If you want to only need the <code>HEAD</code> and want to build on bare-metal (no VirtualBox), you could only clone the latest commit using <code>git clone git://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git --depth=1</code>.</p>
</blockquote>
<p>Next up, you need to generate a <code>.config</code>. This file describes which features you want to compile into your kernel. To make a generic config that only compiles drivers for the hardware of your system, you can run the following commands:</p>
<pre><code class="language-bash"># Copy the config of your current kernel into the repo
make oldconfig

# Only enable modules that are currently used by the system
make localmodconfig
</code></pre>
<p>Now, let&#x27;s get to actually compiling the kernel. In my case, I assigned 4 cores to my VM. The <code>-j</code> option tells make to run 4 jobs in parallel.</p>
<blockquote>
<p><strong>Caution</strong>: Just providing -j will freeze your system, since make will try to launch an infinite amount of processes!</p>
</blockquote>
<pre><code>make -j4
</code></pre>
<p>Again, this might take some time. Go for a walk, get a coffee or watch your favorite TV-show. After compilation has finished, we need to install the kernel. To do so, run the following commands:</p>
<pre><code>sudo make modules_install
sudo make install
</code></pre>
<p>In order to boot, we need to tell our bootloader about our new kernel. Run this command to update your grub config:</p>
<pre><code>sudo update-grub2
</code></pre>
<p>And voila! Your new kernel should be ready.</p>
<p>Reboot the system, and grub should pick up the new kernel and boot to it. If that&#x27;s not the case, you should be able to pick the kernel from the grub menu under <code>advanced options</code>.</p>
<h2 id="retrospective">Retrospective</h2>
<p>I found that building my own kernel is a highly educational and fun experience. Using VirtualBox is a pain in the <code>/dev/null</code> to work with, since it has to add a lot of overhead to the system in order to work. You sometimes have to wait over 6 month until the support for a new kernel arrives. This problem should not apply if you compile on bare metal systems.</p>
<p>Thanks for your time!</p>
<p>This is post 004 of <a href="https://100daystooffload.com/">#100DaysToOffload</a>.</p><hr/><p class="horizontal-list"><button>üíåÔ∏è Reply via E-Mail</button><button>üîó Share</button><button>‚úèÔ∏è Fix Typo</button></p><a href="https://www.buymeacoffee.com/garrit" target="_blank"><img src="https://img.buymeacoffee.com/button-api/?text=Buy me a tea&amp;emoji=&amp;slug=garrit&amp;button_colour=FFB300&amp;font_colour=000000&amp;font_family=Cookie&amp;outline_colour=000000&amp;coffee_colour=ffffff"/></a><hr/><h2>Continue Reading</h2><div><div class="blog__list__post"><time class="blog__list__post__date">Dec 28 2023</time><br/><a href="/posts/2023-12-28-linkdump-2">Linkdump #2</a></div><div class="blog__list__post"><time class="blog__list__post__date">Dec 22 2023</time><br/><a href="/posts/2023-12-22-10-000-hours">10.000 Hours</a></div><div class="blog__list__post"><time class="blog__list__post__date">Dec 21 2023</time><br/><a href="/posts/2023-12-21-notes-on-immutability">Notes on &quot;Immutability Changes Everything&quot;</a></div><div class="blog__list__post"><time class="blog__list__post__date">Dec 18 2023</time><br/><a href="/posts/2023-12-18-overcoming-air-hunger">Overcoming &quot;air hunger&quot;</a></div><div class="blog__list__post"><time class="blog__list__post__date">Nov 29 2023</time><br/><a href="/posts/2023-11-29-real-vs.-fake-trends">Real vs. Fake Trends</a></div></div></div></article></div><footer class="footer"><div class="footer__content"><h3>Links of Interest</h3><a href="/rss.xml">RSS Feed</a><br/><a href="/todo">Todo List</a><br/><a href="https://keyoxide.org/hkp/garrit@slashdev.space">PGP Key</a><br/><a href="/guestbook">Guestbook</a><br/><a href="/blogroll">Blogroll</a><br/><a href="/ctf">Capture the Flag</a><h3>Elsewhere</h3><a href="https://github.com/garritfra" rel="me">Github</a><br/><a href="https://www.linkedin.com/in/garritfranke/">LinkedIn</a><br/><a href="https://fosstodon.org/@garritfra">Mastodon (ActivityPub)</a><br/><a href="/contact">Contact</a></div><p>üëª¬†Proud member of <a target="_blank" href="https://darktheme.club/">darktheme.club</a> <!-- -->üëª</p><p>¬© 2018-<!-- -->2024<!-- --> Garrit Franke<br/><a href="/privacy">Privacy</a> |<!-- --> <a target="_blank" href="https://github.com/garritfra/garrit.xyz">Source Code</a></p></footer></section></div><script id="__NEXT_DATA__" type="application/json" crossorigin="">{"props":{"pageProps":{"post":{"slug":"2021-01-15-compiling-your-own-kernel","markdownBody":"\nI'm currently in the midst of fiddling around with the kernel a bit, and I figured I just documented my process a bit. Unfortunately, since I'm using a Mac for day to day work, I have to rely on a virtual machine to run anything Linux-related. VirtualBox doesn't support the most recent kernels (5.9 is the most recent supported one), so there won't be any cutting-edge development happening here. I decided to use ubuntu as my guest system, since it's very easy to set up.\n\nSo, the first step is to get the sources. You could simply go ahead and download a specific release from [kernel.org](https://kernel.org/), but since I want to hack on it, I decided to go the git-route. Simply download the sources from [their repo](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/) and check out the tag you want to build.\n\n\u003e **Note**: this might take a while. Their repository is huge! If you want to only need the `HEAD` and want to build on bare-metal (no VirtualBox), you could only clone the latest commit using `git clone git://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git --depth=1`.\n\nNext up, you need to generate a `.config`. This file describes which features you want to compile into your kernel. To make a generic config that only compiles drivers for the hardware of your system, you can run the following commands:\n\n```bash\n# Copy the config of your current kernel into the repo\nmake oldconfig\n\n# Only enable modules that are currently used by the system\nmake localmodconfig\n```\n\nNow, let's get to actually compiling the kernel. In my case, I assigned 4 cores to my VM. The `-j` option tells make to run 4 jobs in parallel.\n\n\u003e **Caution**: Just providing -j will freeze your system, since make will try to launch an infinite amount of processes!\n\n```\nmake -j4\n```\n\nAgain, this might take some time. Go for a walk, get a coffee or watch your favorite TV-show. After compilation has finished, we need to install the kernel. To do so, run the following commands:\n\n```\nsudo make modules_install\nsudo make install\n```\n\nIn order to boot, we need to tell our bootloader about our new kernel. Run this command to update your grub config:\n\n```\nsudo update-grub2\n```\n\nAnd voila! Your new kernel should be ready.\n\nReboot the system, and grub should pick up the new kernel and boot to it. If that's not the case, you should be able to pick the kernel from the grub menu under `advanced options`.\n\n## Retrospective\n\nI found that building my own kernel is a highly educational and fun experience. Using VirtualBox is a pain in the `/dev/null` to work with, since it has to add a lot of overhead to the system in order to work. You sometimes have to wait over 6 month until the support for a new kernel arrives. This problem should not apply if you compile on bare metal systems.\n\nThanks for your time!\n\nThis is post 004 of [#100DaysToOffload](https://100daystooffload.com/).\n","frontmatter":{"title":"Compiling your own kernel","date":"2021-01-15","tags":"linux, guide, 100DaysToOffload, infrastructure, tech"},"tags":["linux","guide","100DaysToOffload","infrastructure","tech"]},"recommendedPosts":[{"slug":"2023-12-28-linkdump-2","frontmatter":{"title":"Linkdump #2","date":"2023-12-28","tags":"note, tech, programming, linkdump"},"tags":["note","tech","programming","linkdump"]},{"slug":"2023-12-22-10-000-hours","frontmatter":{"title":"10.000 Hours","date":"2023-12-22","tags":"100DaysToOffload, note, learnings, books, tech, programming"},"tags":["100DaysToOffload","note","learnings","books","tech","programming"]},{"slug":"2023-12-21-notes-on-immutability","frontmatter":{"title":"Notes on \"Immutability Changes Everything\"","date":"2023-12-21","tags":"100DaysToOffload, infrastructure, note, learnings, review, tech, papers"},"tags":["100DaysToOffload","infrastructure","note","learnings","review","tech","papers"]},{"slug":"2023-12-18-overcoming-air-hunger","frontmatter":{"title":"Overcoming \"air hunger\"","date":"2023-12-18","tags":"100DaysToOffload, guide, note, life, til"},"tags":["100DaysToOffload","guide","note","life","til"]},{"slug":"2023-11-29-real-vs.-fake-trends","frontmatter":{"title":"Real vs. Fake Trends","date":"2023-11-29","tags":"100DaysToOffload, note, quote, opinion, tech"},"tags":["100DaysToOffload","note","quote","opinion","tech"]}]},"__N_SSG":true},"page":"/posts/[post]","query":{"post":"2021-01-15-compiling-your-own-kernel"},"buildId":"nrrBUjPSWR0mSvEDGN-1p","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>