<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width, initial-scale=1"/><meta charSet="utf-8"/><title>Mistakes I made writing my first compiler, and what I would do better next time</title><meta name="Description" content="Generalist developer writing about fullstack development, system administration and free software."/><link rel="icon" type="image/svg+xml" href="/favicon.svg"/><link rel="webmention" href="https://webmention.io/garrit.xyz/webmention"/><link rel="pingback" href="https://webmention.io/garrit.xyz/xmlrpc"/><link href="https://cdn.jsdelivr.net/npm/shareon@2/dist/shareon.min.css" rel="stylesheet"/><meta name="next-head-count" content="8"/><link rel="preload" href="/_next/static/css/b5b5c17d6a7c0345.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b5b5c17d6a7c0345.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-ee7e63bc15b31913.js" defer=""></script><script src="/_next/static/chunks/framework-2c79e2a64abdb08b.js" defer=""></script><script src="/_next/static/chunks/main-7477d36a73a3487c.js" defer=""></script><script src="/_next/static/chunks/pages/_app-72a7c2f5e44704ad.js" defer=""></script><script src="/_next/static/chunks/658-b09a7bad2e31500b.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bpost%5D-0d6de81b0f6f2aa3.js" defer=""></script><script src="/_next/static/3djzJtYLMMh023kQe-KCP/_buildManifest.js" defer=""></script><script src="/_next/static/3djzJtYLMMh023kQe-KCP/_ssgManifest.js" defer=""></script></head><body><div id="__next"><section class="layout"><header class="header"><nav class="nav" role="navigation" aria-label="main navigation"><div class="header__container"><a href="/" class="header__container__logo underlined">Garrit&#x27;s Notes</a></div><ul class="header__links"><li><a href="/posts" class="underlined">Blog</a></li><li><a href="/contact" class="underlined">Contact</a></li><li><a href="/cv" class="underlined">Resume</a></li></ul></nav></header><div class="content"><article class="page h-entry"><div class="page__info"><h1 class="p-name">Mistakes I made writing my first compiler, and what I would do better next time</h1><time class="page__info__date">Nov 28 2022</time></div><div class="page__body e-content"><p>My most ambitious side project so far has been the <a href="https://github.com/antimony-lang/antimony">Antimony Programming
Language</a>. It&#x27;s a compiler for a
programming language I made up about two years ago. It can be used for basic
programs and algorithms, but anything beyond
<a href="https://github.com/antimony-lang/antimony/blob/master/examples/bubblesort.sb">bubblesort</a>
and the <a href="https://github.com/antimony-lang/antimony/blob/master/examples/ackermann.sb">ackermann
function</a>
wasn&#x27;t feasible.</p>
<p>Unfortunately, the language never grew out of the &quot;toy&quot; phase, so I more or less
abandoned it. Looking back, I definitely learned a lot about compilers, and if I
were to write another language (which I will most likely do in the future),
there are some things that I would do better next time.</p>
<h2 id="statements-are-expressions-minus-flexibility" level="2">Statements are expressions minus flexibility</h2>
<p>The syntax of many C-like programming languages can be broken up into two
categories. An <code>Expression</code> is anything that resolves a value.</p>
<pre><code class="language-c">1 + 2       // 3
5 * 8 + 2   // 42
1 &lt; 2       // true
addOne(1)   // 2 (assuming `addOne` returns the given value plus one)
[1, 2, 3]   // Array containing a 1, a 2 and a 3
</code></pre>
<p>A <code>Statement</code> resembles an action or branch in a program.</p>
<pre><code class="language-c">int foo() {                 // Declare statement
    int bar = 1;            // Assignment statement
    if (bar &gt;= 1) {         // Conditional statement
        printf(&quot;%d&quot;, bar);  // Function call expressions can be statements too!
    }
}
</code></pre>
<p>Antimony picks up on this concept, and strictly separates statements from
expressions. Some modern programming languages (E.g.
<a href="https://rust-lang.org/">Rust</a>) got rid of most types of statements by just
declaring almost anything an expression. There are just <a href="https://doc.rust-lang.org/reference/statements.html#declaration-statements">Declaration
Statements</a>
used for function and variable declaration, and <a href="https://doc.rust-lang.org/reference/statements.html#expression-statements">Expression
Statements</a>,
which can contain any arbitrary expression. This allows us to introduce a lot of
nice features that are very hard to implement if we treated statements as actual statements</p>
<pre><code class="language-rust">let foo = if 1 &gt; 2 {
    1
} else {
    for {
        break 2
    }
}

print(foo)  // 2
</code></pre>
<p>Unfortunately, I realized the benefits of extensively using expressions too late.</p>
<p>TODO</p>
<h2 id="don&#x27;t-add-types-as-an-afterthought" level="2">Don&#x27;t add types as an afterthought</h2>
<h2 id="multiple-backends-=-exponential-headaches" level="2">Multiple backends = exponential headaches</h2>
<h2 id="&quot;i-won&#x27;t-need-an-ir&quot;-is-a-lie" level="2">&quot;I won&#x27;t need an IR&quot; is a lie</h2><hr/><p><a href="mailto:garrit@slashdev.space?subject=Re: Mistakes%20I%20made%20writing%20my%20first%20compiler%2C%20and%20what%20I%20would%20do%20better%20next%20time">Reply via E-Mail</a></p><a href="https://www.buymeacoffee.com/garrit" target="_blank"><img src="https://img.buymeacoffee.com/button-api/?text=Buy me a coffee&amp;emoji=&amp;slug=garrit&amp;button_colour=FFDD00&amp;font_colour=000000&amp;font_family=Cookie&amp;outline_colour=000000&amp;coffee_colour=ffffff"/></a><p class="page__tag-list"><svg class="page__tag-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg><a href="/posts?tags=note">#<!-- -->note</a><a href="/posts?tags=100DaysToOffload">#<!-- -->100DaysToOffload</a></p><div class="shareon"><a class="facebook"></a><a class="linkedin"></a><a class="mastodon"></a><a class="pocket"></a><a class="reddit"></a><a class="telegram"></a><a class="twitter"></a><a class="whatsapp"></a></div></div></article></div><footer class="footer"><div class="footer__content"><h3>Links of Interest</h3><a href="/rss.xml">RSS Feed</a><br/><a href="/todo">Todo List</a><br/><a href="https://keyoxide.org/hkp/garrit@slashdev.space">PGP Key</a><br/><a href="/guestbook">Guestbook</a><br/><a href="/blogroll">Blogroll</a><br/><a href="/ctf">Capture the Flag</a><h3>Elsewhere</h3><a href="https://github.com/garritfra" rel="me">Github</a><br/><a href="https://www.linkedin.com/in/garritfranke/">LinkedIn</a><br/><a href="https://fosstodon.org/@garritfra">Mastodon (ActivityPub)</a><br/><a href="/contact">Contact</a></div><p>ðŸ‘»Â Proud member of <a target="_blank" href="https://darktheme.club/">darktheme.club</a> <!-- -->ðŸ‘»</p><p>Â© 2018-<!-- -->2023<!-- --> Garrit Franke<br/><a href="/privacy">Privacy</a> |<!-- --> <a target="_blank" href="https://github.com/garritfra/garrit.xyz">Source Code</a></p></footer></section></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"frontmatter":{"title":"Mistakes I made writing my first compiler, and what I would do better next time","date":"2022-11-28","tags":"note, 100DaysToOffload"},"markdownBody":"\nMy most ambitious side project so far has been the [Antimony Programming\nLanguage](https://github.com/antimony-lang/antimony). It's a compiler for a\nprogramming language I made up about two years ago. It can be used for basic\nprograms and algorithms, but anything beyond\n[bubblesort](https://github.com/antimony-lang/antimony/blob/master/examples/bubblesort.sb)\nand the [ackermann\nfunction](https://github.com/antimony-lang/antimony/blob/master/examples/ackermann.sb)\nwasn't feasible.\n\nUnfortunately, the language never grew out of the \"toy\" phase, so I more or less\nabandoned it. Looking back, I definitely learned a lot about compilers, and if I\nwere to write another language (which I will most likely do in the future),\nthere are some things that I would do better next time.\n\n## Statements are expressions minus flexibility\n\nThe syntax of many C-like programming languages can be broken up into two\ncategories. An `Expression` is anything that resolves a value.\n\n```c\n1 + 2       // 3\n5 * 8 + 2   // 42\n1 \u003c 2       // true\naddOne(1)   // 2 (assuming `addOne` returns the given value plus one)\n[1, 2, 3]   // Array containing a 1, a 2 and a 3\n```\n\nA `Statement` resembles an action or branch in a program.\n\n```c\nint foo() {                 // Declare statement\n    int bar = 1;            // Assignment statement\n    if (bar \u003e= 1) {         // Conditional statement\n        printf(\"%d\", bar);  // Function call expressions can be statements too!\n    }\n}\n```\n\nAntimony picks up on this concept, and strictly separates statements from\nexpressions. Some modern programming languages (E.g.\n[Rust](https://rust-lang.org/)) got rid of most types of statements by just\ndeclaring almost anything an expression. There are just [Declaration\nStatements](https://doc.rust-lang.org/reference/statements.html#declaration-statements)\nused for function and variable declaration, and [Expression\nStatements](https://doc.rust-lang.org/reference/statements.html#expression-statements),\nwhich can contain any arbitrary expression. This allows us to introduce a lot of\nnice features that are very hard to implement if we treated statements as actual statements\n\n```rust\nlet foo = if 1 \u003e 2 {\n    1\n} else {\n    for {\n        break 2\n    }\n}\n\nprint(foo)  // 2\n```\n\nUnfortunately, I realized the benefits of extensively using expressions too late.\n\nTODO\n\n## Don't add types as an afterthought\n\n## Multiple backends = exponential headaches\n\n## \"I won't need an IR\" is a lie\n"},"__N_SSG":true},"page":"/posts/[post]","query":{"post":"_2022-11-28-mistakes-i-made-writing-my-first-compiler,-and-what-i-would-do-better-next-time"},"buildId":"3djzJtYLMMh023kQe-KCP","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>