<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width, initial-scale=1"/><meta charSet="utf-8"/><title>Garrit&#x27;s Notes</title><meta name="Description" content="Generalist developer writing about fullstack development, system administration and free software."/><link rel="icon" type="image/svg+xml" href="/favicon.svg"/><link rel="webmention" href="https://webmention.io/garrit.xyz/webmention"/><link rel="pingback" href="https://webmention.io/garrit.xyz/xmlrpc"/><script async="" defer="" data-domain="garrit.xyz" src="https://analytics.slashdev.space/js/plausible.js"></script><meta name="next-head-count" content="8"/><link rel="preload" href="https://garrit.xyz/_next/static/css/75b1b18762110d83.css" as="style"/><link rel="stylesheet" href="https://garrit.xyz/_next/static/css/75b1b18762110d83.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="https://garrit.xyz/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="https://garrit.xyz/_next/static/chunks/webpack-419417af898ef431.js" defer=""></script><script src="https://garrit.xyz/_next/static/chunks/framework-5f4595e5518b5600.js" defer=""></script><script src="https://garrit.xyz/_next/static/chunks/main-01df828e572375b9.js" defer=""></script><script src="https://garrit.xyz/_next/static/chunks/pages/_app-893697fd17d143b4.js" defer=""></script><script src="https://garrit.xyz/_next/static/chunks/217-71d6f836ade4eae9.js" defer=""></script><script src="https://garrit.xyz/_next/static/chunks/768-d1db3457a00e9fa7.js" defer=""></script><script src="https://garrit.xyz/_next/static/chunks/pages/posts/%5Bpost%5D-ec739ebb4ae5b8b7.js" defer=""></script><script src="https://garrit.xyz/_next/static/IKEoHL9qhR1ZeQrwjZbrp/_buildManifest.js" defer=""></script><script src="https://garrit.xyz/_next/static/IKEoHL9qhR1ZeQrwjZbrp/_ssgManifest.js" defer=""></script><script src="https://garrit.xyz/_next/static/IKEoHL9qhR1ZeQrwjZbrp/_middlewareManifest.js" defer=""></script><style id="__jsx-8946a52cf42f2313">.layout.jsx-8946a52cf42f2313{overflow-x:hidden;
display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
-webkit-flex-direction:column;
-ms-flex-direction:column;
flex-direction:column;
min-height:100vh}
.layout.jsx-8946a52cf42f2313 .info_page.jsx-8946a52cf42f2313{color:#ebebeb}
.content.jsx-8946a52cf42f2313{}
@media (min-width:768px) {}</style></head><body><div id="__next" data-reactroot=""><section class="jsx-8946a52cf42f2313 layout"><header class="header"><nav class="nav" role="navigation" aria-label="main navigation"><a href="/" class="header__logo"><div style="opacity:0"><span>Garrit&#x27;s Notes</span></div></a><ul class="header__links"><li><a href="/posts">Blog</a></li><li><a href="/cv">Resume</a></li></ul></nav></header><div class="jsx-8946a52cf42f2313 content"><article class="page h-entry"><div class="page__info"><h1 class="p-name">Finally fixing that annoying Cron gotcha</h1><h3 class="page__info__date">Sep 13 2021</h3></div><div class="page__body e-content"><p>A while ago I went through my server and reworked my <a href="/posts/2021-02-07-storage-setup">storage
setup</a>. As discribed in that blog post, I set
up daily backups to <a href="https://www.backblaze.com/b2/cloud-storage.html">Backblaze
B2</a> using their amazing CLI
through a cron script. A day went by and I noticed that the
<a href="/posts/2021-05-15-healthchecks-io-with-docker">healthcheck</a> didn&#x27;t pass.
Unfortunately I didn&#x27;t have time to fix this problem immediately, so instead I
executed the command by hand every couple of days. One could argue that this in
total took way more time than the actual fix, but hey, I was lazy. In the end,
I finally dedicated some time to fix this annoying issue.</p>
<p>It turns out that a command executed by cron doesn&#x27;t run through sh or bash,
but in a minimal environment without your usual environment-variables. As a
result, my <code>b2</code> command (and many other commands for that matter) won&#x27;t run as
expected, if at all. A quick fix is to run your command through bash or sh
explicitly:</p>
<pre><code class="language-sh">sh -c &quot;mycommand&quot;
</code></pre>
<p>Alternatively, if you want all your entries to use sh or bash, you can set the
<code>SHELL</code> variable at the very beginning of your crontab:</p>
<pre><code class="language-sh">SHELL=/bin/bash

15 1 * * * some_command
</code></pre>
<p><a href="https://askubuntu.com/a/23438">Here</a> is an answer that goes into more detail
about this. Have a great day!</p>
<p>This is post 019 of <a href="https://100daystooffload.com/">#100DaysToOffload</a>.</p><hr/><p>If you enjoyed this post, consider<!-- --> <a href="https://donate.slashdev.space">buying me a coffee</a>! Got comments? Send me a<!-- --> <a href="mailto:garrit@slashdev.space">Mail</a>, or shoot me a message on<!-- --> <a href="https://matrix.to/#/@garrit:matrix.slashdev.space">Matrix</a>.</p><div class="blog__footer"><h3>Written By: Garrit Franke</h3></div></div><div class="page__footer"></div></article></div><footer class="footer"><div class="footer__content"><section class="footer__content__links"><h3>Links of Interest</h3><a href="/rss.xml">RSS Feed</a><br/><a href="/todo">Todo List</a><br/><a href="https://keyoxide.org/hkp/garrit@slashdev.space">PGP Key</a><br/><a href="/blogroll">Blogroll</a></section><section class="footer__content__social"><h3>Elsewhere</h3><a href="https://github.com/garritfra" rel="me">Github</a><br/><a href="https://www.linkedin.com/in/garritfranke/">LinkedIn</a><br/><a href="mailto:garrit@slashdev.space" rel="me">Email</a><br/><a href="https://matrix.to/#/@garrit:matrix.slashdev.space">Matrix</a></section></div><p>Â© 2018-2022 Garrit Franke</p></footer></section></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"frontmatter":{"title":"Finally fixing that annoying Cron gotcha","date":"2021-09-13","tags":"linux, guide, 100DaysToOffload"},"markdownBody":"\nA while ago I went through my server and reworked my [storage\nsetup](/posts/2021-02-07-storage-setup). As discribed in that blog post, I set\nup daily backups to [Backblaze\nB2](https://www.backblaze.com/b2/cloud-storage.html) using their amazing CLI\nthrough a cron script. A day went by and I noticed that the\n[healthcheck](/posts/2021-05-15-healthchecks-io-with-docker) didn't pass.\nUnfortunately I didn't have time to fix this problem immediately, so instead I\nexecuted the command by hand every couple of days. One could argue that this in\ntotal took way more time than the actual fix, but hey, I was lazy. In the end,\nI finally dedicated some time to fix this annoying issue.\n\nIt turns out that a command executed by cron doesn't run through sh or bash,\nbut in a minimal environment without your usual environment-variables. As a\nresult, my `b2` command (and many other commands for that matter) won't run as\nexpected, if at all. A quick fix is to run your command through bash or sh\nexplicitly:\n\n```sh\nsh -c \"mycommand\"\n```\n\nAlternatively, if you want all your entries to use sh or bash, you can set the\n`SHELL` variable at the very beginning of your crontab:\n\n```sh\nSHELL=/bin/bash\n\n15 1 * * * some_command\n```\n\n[Here](https://askubuntu.com/a/23438) is an answer that goes into more detail\nabout this. Have a great day!\n\nThis is post 019 of [#100DaysToOffload](https://100daystooffload.com/).\n"},"__N_SSG":true},"page":"/posts/[post]","query":{"post":"2021-09-13-fixing-an-annoying-cron-gotcha"},"buildId":"IKEoHL9qhR1ZeQrwjZbrp","assetPrefix":"https://garrit.xyz","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>