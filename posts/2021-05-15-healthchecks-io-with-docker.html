<!DOCTYPE html><html><head><script async="" defer="" data-domain="garrit.xyz" src="https://analytics.slashdev.space/js/index.outbound-links.js"></script><script>window.plausible = window.plausible || function() { (window.plausible.q = window.plausible.q || []).push(arguments) }</script><meta name="viewport" content="width=device-width, initial-scale=1"/><meta charSet="utf-8"/><title>Garrit&#x27;s Notes</title><meta name="Description" content="Generalist developer writing about fullstack development, system administration and free software."/><link rel="icon" type="image/svg+xml" href="/favicon.svg"/><link rel="webmention" href="https://webmention.io/garrit.xyz/webmention"/><link rel="pingback" href="https://webmention.io/garrit.xyz/xmlrpc"/><meta name="next-head-count" content="9"/><link rel="preload" href="https://garrit.xyz/_next/static/css/346f005c71d4d41a.css" as="style"/><link rel="stylesheet" href="https://garrit.xyz/_next/static/css/346f005c71d4d41a.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="https://garrit.xyz/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="https://garrit.xyz/_next/static/chunks/webpack-419417af898ef431.js" defer=""></script><script src="https://garrit.xyz/_next/static/chunks/framework-5f4595e5518b5600.js" defer=""></script><script src="https://garrit.xyz/_next/static/chunks/main-01df828e572375b9.js" defer=""></script><script src="https://garrit.xyz/_next/static/chunks/pages/_app-3d8f3259577ba4a8.js" defer=""></script><script src="https://garrit.xyz/_next/static/chunks/988-48b55eebb161e8d8.js" defer=""></script><script src="https://garrit.xyz/_next/static/chunks/746-6cb8fd2335c400fd.js" defer=""></script><script src="https://garrit.xyz/_next/static/chunks/768-d1db3457a00e9fa7.js" defer=""></script><script src="https://garrit.xyz/_next/static/chunks/pages/posts/%5Bpost%5D-46a78dbf1e05f708.js" defer=""></script><script src="https://garrit.xyz/_next/static/QnEOgu9FpyztYuUyKs2E7/_buildManifest.js" defer=""></script><script src="https://garrit.xyz/_next/static/QnEOgu9FpyztYuUyKs2E7/_ssgManifest.js" defer=""></script><script src="https://garrit.xyz/_next/static/QnEOgu9FpyztYuUyKs2E7/_middlewareManifest.js" defer=""></script><style id="__jsx-8946a52cf42f2313">.layout.jsx-8946a52cf42f2313{overflow-x:hidden;
display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
-webkit-flex-direction:column;
-ms-flex-direction:column;
flex-direction:column;
min-height:100vh}
.layout.jsx-8946a52cf42f2313 .info_page.jsx-8946a52cf42f2313{color:#ebebeb}
.content.jsx-8946a52cf42f2313{}
@media (min-width:768px) {}</style></head><body><div id="__next" data-reactroot=""><section class="jsx-8946a52cf42f2313 layout"><header class="header"><a href="https://donate.redcrossredcrescent.org/ua/donate/~my-donation?_cv=1" style="height:64px;text-align:center" class="flag--ukraine" target="_blank">Help Ukraine</a><nav class="nav" role="navigation" aria-label="main navigation"><div class="header__container"><a href="/" class="header__container__logo underlined">Garrit&#x27;s Notes</a></div><ul class="header__links"><li><a href="/posts" class="underlined">Blog</a></li><li><a href="/contact" class="underlined">Contact</a></li><li><a href="/cv" class="underlined">Resume</a></li></ul></nav></header><div class="jsx-8946a52cf42f2313 content"><article class="page h-entry"><div class="page__info"><h1 class="p-name">Docker healthchecks using healthchecks.io</h1><h3 class="page__info__date">May 15 2021</h3></div><div class="page__body e-content"><p>I&#x27;m currently in the midst of improving the monitoring of my infrastructure. I
make heavy use of docker and docker-compose for my hosting, so it&#x27;s vital to add
monitoring for most of the containers.</p>
<p>I&#x27;m hosting my own instance of <a href="https://healthchecks.io/">healthchecks.io</a>.
Their solution to monitoring involves <strong>you</strong> having to ping <strong>them</strong>, instead
of the other way around. This let&#x27;s you add healthchecks to virtually anything
that can ping a http-endpoint.</p>
<p>docker-compose let&#x27;s you define healthchecks to your config that, when
completing sucessfully, mark the container as &quot;healthy&quot;. The process of adding
such a healthcheck is simple. First, create a new check in your healthchecks.io
account and set the ping interval to 1 minute, or a value you prefer. Then, add
this snippet to your docker-compose file:</p>
<pre><code class="language-yaml">app:
    image: nextcloud
    ports:
        - 127.0.0.1:8080:80
    healthcheck:
        test:
            [
                &quot;CMD&quot;,
                &quot;curl&quot;,
                &quot;-f&quot;,
                &quot;https://app-endpoint.tld&quot;,
                &quot;&amp;&amp;&quot;,
                &quot;curl&quot;,
                &quot;-fsS&quot;,
                &quot;-m&quot;,
                &quot;10&quot;,
                &quot;--retry&quot;,
                &quot;5&quot;,
                &quot;-o&quot;,
                &quot;/dev/null&quot;,
                &quot;https://healthchecks.io/ping/&lt;UUID&gt;&quot;,
            ]
        interval: 60s
        timeout: 10s
        retries: 6
</code></pre>
<p>Change the first url to the url of your app. The second URL is the endpoint of
your healthchecks.io instance. You can obtain it from the check you configured
earlier.</p>
<p>This configuration will try to ping your application and, if successful, notify
the healthcheck that the application is healthy. If the app is not reachable or
the container is down, the latter request will not be executed and your service
is marked as &quot;down&quot;.</p>
<p>In addition to the healthchecks of my docker containers, I also added basic
healthchecks to my servers cronfiles and its backup-commands.</p>
<p>Do you have any suggestions regarding this topic? Feel free to reach out to me
via Matrix or email!</p>
<p>This is post 017 of <a href="https://100daystooffload.com/">#100DaysToOffload</a>.</p><hr/><a href="mailto:garrit@slashdev.space?subject=Re: Docker%20healthchecks%20using%20healthchecks.io">Reply via E-Mail</a></div></article></div><footer class="footer"><div class="footer__content"><section class="footer__content__links"><h3>Links of Interest</h3><a href="/rss.xml">RSS Feed</a><br/><a href="/todo">Todo List</a><br/><a href="https://keyoxide.org/hkp/garrit@slashdev.space">PGP Key</a><br/><a href="/blogroll">Blogroll</a></section><section class="footer__content__social"><h3>Elsewhere</h3><a href="https://github.com/garritfra" rel="me">Github</a><br/><a href="https://www.linkedin.com/in/garritfranke/">LinkedIn</a><br/><a href="https://fosstodon.org/@garritfra">Mastodon (ActivityPub)</a><br/><a href="/contact">Contact</a></section></div><p>Â© 2018-2022 Garrit Franke</p></footer></section>;</div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"frontmatter":{"title":"Docker healthchecks using healthchecks.io","date":"2021-05-15","tags":"docker, 100DaysToOffload, guide"},"markdownBody":"\nI'm currently in the midst of improving the monitoring of my infrastructure. I\nmake heavy use of docker and docker-compose for my hosting, so it's vital to add\nmonitoring for most of the containers.\n\nI'm hosting my own instance of [healthchecks.io](https://healthchecks.io/).\nTheir solution to monitoring involves **you** having to ping **them**, instead\nof the other way around. This let's you add healthchecks to virtually anything\nthat can ping a http-endpoint.\n\ndocker-compose let's you define healthchecks to your config that, when\ncompleting sucessfully, mark the container as \"healthy\". The process of adding\nsuch a healthcheck is simple. First, create a new check in your healthchecks.io\naccount and set the ping interval to 1 minute, or a value you prefer. Then, add\nthis snippet to your docker-compose file:\n\n```yaml\napp:\n    image: nextcloud\n    ports:\n        - 127.0.0.1:8080:80\n    healthcheck:\n        test:\n            [\n                \"CMD\",\n                \"curl\",\n                \"-f\",\n                \"https://app-endpoint.tld\",\n                \"\u0026\u0026\",\n                \"curl\",\n                \"-fsS\",\n                \"-m\",\n                \"10\",\n                \"--retry\",\n                \"5\",\n                \"-o\",\n                \"/dev/null\",\n                \"https://healthchecks.io/ping/\u003cUUID\u003e\",\n            ]\n        interval: 60s\n        timeout: 10s\n        retries: 6\n```\n\nChange the first url to the url of your app. The second URL is the endpoint of\nyour healthchecks.io instance. You can obtain it from the check you configured\nearlier.\n\nThis configuration will try to ping your application and, if successful, notify\nthe healthcheck that the application is healthy. If the app is not reachable or\nthe container is down, the latter request will not be executed and your service\nis marked as \"down\".\n\nIn addition to the healthchecks of my docker containers, I also added basic\nhealthchecks to my servers cronfiles and its backup-commands.\n\nDo you have any suggestions regarding this topic? Feel free to reach out to me\nvia Matrix or email!\n\nThis is post 017 of [#100DaysToOffload](https://100daystooffload.com/).\n"},"__N_SSG":true},"page":"/posts/[post]","query":{"post":"2021-05-15-healthchecks-io-with-docker"},"buildId":"QnEOgu9FpyztYuUyKs2E7","assetPrefix":"https://garrit.xyz","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>