{"pageProps":{"post":{"slug":"2023-03-10-debugging-ecs-tasks","markdownBody":"\r\nI just had to debug an application on AWS ECS. The whole procedure is documented in more detail in the [documentation](https://docs.aws.amazon.com/AmazonECS/latest/developerguide/ecs-exec.html), but I think it's beneficial (both for my future self and hopefully to someone out there) to write down the proccess in my own words.\r\n\r\nFirst of all, you need access to the cluster via the [CLI](https://aws.amazon.com/de/cli/). In addition to the CLI, you need the [AWS Session Manager plugin for the CLI](https://docs.aws.amazon.com/systems-manager/latest/userguide/session-manager-working-with-install-plugin.html). If you're on MacOS, you can install that via [Homebrew](https://formulae.brew.sh/cask/session-manager-plugin):\r\n\r\n```\r\nbrew install --cask session-manager-plugin\r\n```\r\n\r\nNext, you need to allow the task you want to debug to be able to execute commands. Since I'm using Terraform, this was just a matter of adding the [`enable_execute_command`](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ecs_service#enable_execute_command) attribute to the service:\r\n\r\n```tf\r\nresource \"aws_ecs_service\" \"my_service\" {\r\n  name            = \"my-service\"\r\n  cluster         = aws_ecs_cluster.my_cluster.id\r\n  task_definition = aws_ecs_task_definition.my_task_definition.id\r\n  desired_count   = var.app_count\r\n  launch_type     = \"FARGATE\"\r\n  enable_execute_command = true # TODO: Disable after debugging\r\n}\r\n```\r\n\r\nYou may also need specify an execution role in the task definition:\r\n\r\n```tf\r\nresource \"aws_ecs_task_definition\" \"my_task_definition\" {\r\n  family              = \"my-task\"\r\n  task_role_arn       = aws_iam_role.ecs_task_execution_role.arn\r\n  execution_role_arn  = aws_iam_role.ecs_task_execution_role.arn  # <-- Add this\r\n}\r\n```\r\n\r\nMake sure that this role has the correct access rights. There's a nice [troubleshooting guide](https://aws.amazon.com/de/premiumsupport/knowledge-center/ecs-error-execute-command/) going over the required permissions.\r\n\r\nIf you had to do some modifications, make sure to roll out a new deployment with the fresh settings:\r\n\r\n```\r\naws ecs update-service --cluster my-cluster --service my-service --force-new-deployment\r\n```\r\n\r\nNow, you should be able to issue commands against any running container!\r\n\r\n```\r\naws ecs execute-command --cluster westfalen --task <task-id-or-arn> --container my-container --interactive --command=\"/bin/sh\"\r\n```\r\n\r\nI hope this helps!\r\n\r\n---\r\n\r\nThis is post 055 of [#100DaysToOffload](https://100daystooffload.com/).\r\n","frontmatter":{"title":"Debugging ECS Tasks","date":"2023-03-10","tags":"100DaysToOffload, infrastructure, aws, guide, note, terraform"},"tags":["100DaysToOffload","infrastructure","aws","guide","note","terraform"]},"recommendedPosts":[{"slug":"2023-06-01-single-page-applications-on-github-pages","frontmatter":{"title":"Single Page Applications on GitHub Pages","date":"2023-06-01","tags":"100DaysToOffload, guide, note, web, javascript, github"},"tags":["100DaysToOffload","guide","note","web","javascript","github"]},{"slug":"2023-04-28-serverless-framework-retrospective","frontmatter":{"title":"Serverless Framework Retrospective","date":"2023-04-28","tags":"100DaysToOffload, infrastructure, aws, note, terraform, learnings, devops, serverless"},"tags":["100DaysToOffload","infrastructure","aws","note","terraform","learnings","devops","serverless"]},{"slug":"2023-04-27-migrating-homeassistant-from-sd-to-ssd","frontmatter":{"title":"Migrating Homeassistant from SD to SSD","date":"2023-04-27","tags":"100DaysToOffload, guide, note, homeassistant, homelab"},"tags":["100DaysToOffload","guide","note","homeassistant","homelab"]},{"slug":"2023-04-12-instant-dark-theme","frontmatter":{"title":"Instant dark theme","date":"2023-04-12","tags":"100DaysToOffload, guide, note, learnings, web, css, til"},"tags":["100DaysToOffload","guide","note","learnings","web","css","til"]},{"slug":"2023-03-30-designing-resilient-cloud-infrastructure","frontmatter":{"title":"Designing resilient cloud infrastructure","date":"2023-03-30","tags":"100DaysToOffload, infrastructure, aws, guide, note, learnings"},"tags":["100DaysToOffload","infrastructure","aws","guide","note","learnings"]}]},"__N_SSG":true}