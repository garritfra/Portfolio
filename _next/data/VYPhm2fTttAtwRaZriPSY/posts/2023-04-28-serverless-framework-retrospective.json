{"pageProps":{"post":{"slug":"2023-04-28-serverless-framework-retrospective","markdownBody":"\nA current project requires the infrastructure to be highly scalable. It's expected that > 50k Users hit the platform within a five minute period. Regular ECS containers take about one minute to scale up. That just won't cut it. I decided to go all in on the [serverless](https://www.serverless.com/) framework on AWS. Here's how it went.\r\n\r\n### Setup\r\n\r\nSetting up a serverless application was a breeze. You create a config file and use their CLI to deploy the app.\r\n\r\n### The rest of the infrastructure\r\n\r\nI decided to define the rest of the infrastructure (VPC, DB, cache, ...) in Terraform. But, since I wasn't familiar with how the Serverless Framework worked, I struggled to draw the line between what serverless should handle vs. what the rest of the infrastructure (Terraform) should provide. In a more traditional deployment workflow, you might let the CI deploy a container image to ECR and point the ECS service to that new image.\r\n\r\nI chose to let Serverless deploy the entire app through CI and build the rest of the infrastructure around it. The problem with this approach is that we lose fine-grained control over what's deployed where, which leads to a lot of permission errors.\r\n\r\nIn retrospect, I should've probably chosen the location of the S3 archive as the deployment target for the CI, and then point the lambda function to the location of the new artifact. This defeats the purpose of the framework, but it gives you a lot more control over your infrastructure. Once the next project comes along, I'll probably go that route instead.\r\n\r\n### Permissions\r\n\r\nServerless suggests to use admin permissions for deployments, and I see where they're coming from. Managing permissions in this framework is an absolute mess. Here's what the average deployment workflow looks like, if you want to use fine grained permissions:\r\n\r\n1. Wait for CloudFormation to roll back changes (~2 minutes)\r\n2. Update IAM role\r\n3. Deploy Serverless App\r\n4. If there's an error, go to 1\r\n\r\nThankfully, some people have already gone through the process of figuring this out. [Here's](https://serverlessfirst.com/create-iam-deployer-roles-serverless-app/#determining-deploy-time-permissions) a great guide with a starting point of the needed permissions.\r\n\r\n### Conclusion\r\n\r\nUsing the serverless framework is a solid choice if you just want to throw an app out there. Unfortunately the app I was deploying isn't \"just\" a dynamic website. The next time I'm building a serverless application it's probably not going to be with the Serverless Framework, though I learned a lot about serverless applications in general.\r\n\r\n---\r\n\r\nThis is post 067 of [#100DaysToOffload](https://100daystooffload.com/).\r\n\r\n\r\n\r\n\n","frontmatter":{"title":"Serverless Framework Retrospective","date":"2023-04-28","tags":"100DaysToOffload, infrastructure, aws, note, terraform, learnings, devops, serverless"},"tags":["100DaysToOffload","infrastructure","aws","note","terraform","learnings","devops","serverless"]},"recommendedPosts":[{"slug":"2023-05-19-work-batch-sizing","markdownBody":"\nI've been playing \n[Carcassonne](https://en.m.wikipedia.org/wiki/Carcassonne_(board_game)) a lot with my girlfriend recently. It's a boardgame about building cities, roads and farms, and each completed \"project\" earns you some amount of points. The twist is that there's only a limited number of tiles, and once all tiles are used, the game is over unfinished projects are discarded.\n\nThe first couple of playthroughs I tried to maximize my score by increasing the number of projects I actively had going. I'd start a new city or road whenever I could, thinking that the multipliers you sometimes get would pay off in the end. Boy was I wrong.\n\nWhere I'm from, we have multiple sayings for this approach. \"Having too many irons in the fire\" or \"dancing on too many parties\". I was too busy starting new projects instead of making actual progress.\n\nA far better approach is to finish projects early, earning less points, but with a greater certainty that they will pay off. With every project you start, the likelyhood of the other projects paying off decreases.\n\nKeeping batch sizes small was a key concept of the [lean manufacturing movement](https://en.m.wikipedia.org/wiki/Lean_manufacturing) in the 1980s, and has since been adopted by the [DevOps movement](https://de.m.wikipedia.org/wiki/DevOps) for the IT industry. If you want to learn more about this topic, you should check out [The DevOps Handbook](https://itrevolution.com/product/the-devops-handbook-second-edition/). It goes well beyond the basics of making IT processes more productive and efficient.\n\nAfter realizing that small batch sizes are the key to success, I haven't lost a game of Carcassonne since. I hope you're not reading this, honey.ðŸ¤­\n\n---\n\nThis is post 068 of [#100DaysToOffload](https://100daystooffload.com/).\n","frontmatter":{"title":"Optimizing work batch size","date":"2023-05-19","tags":"100DaysToOffload, note, practices, learnings, life, devops"},"tags":["100DaysToOffload","note","practices","learnings","life","devops"]},{"slug":"2023-04-22-the-role-of-a-devops-engineer","markdownBody":"\nThe term \"DevOps\" can be interpreted in many different ways. It's often thrown around as a buzzword whenever somebody is talking about \"what comes after development\". Obviously, it's not just that. Or is it? It depends on whom you're talking to.\r\n\r\nAlthough I just recently started my new role as a \"DevOps Engineer\", I'm still discovering what that term means to me. I just had a fruitful conversation with the DevOps lead of a client, and they phrased this role in a very fitting way.\r\n\r\n> A DevOps Engineer doesn't push the button, they enable the developers to push the button themselves.\r\n\r\nTo me this role is fascinating, since it touches so many different aspects of software delivery.\r\n\r\n---\r\n\r\nThis is post 065 of [#100DaysToOffload](https://100daystooffload.com/).\n","frontmatter":{"title":"The role of a DevOps Engineer","date":"2023-04-22","tags":"100DaysToOffload, note, practices, devops"},"tags":["100DaysToOffload","note","practices","devops"]},{"slug":"2023-04-12-instant-dark-theme","markdownBody":"\nThanks to [Jacksons](https://jacksonchen666.com/) [update to darktheme.club](https://github.com/garritfra/darktheme.club/pull/79), I just came across a neat little [CSS property](https://developer.mozilla.org/en-US/docs/Web/CSS/color-scheme) that turns a mostly CSS-free document into a pleasantly dark site:\r\n\r\n```css\r\n:root {\r\n  color-scheme: light dark;\r\n}\r\n```\r\n\r\nThis will adjust all elements on the page to the color scheme preferred by the user - without any other custom styles! ðŸ¤¯ It is also [widely supported](https://caniuse.com/mdn-css_properties_color-scheme) by browsers.\r\n\r\nI've always been quite dependent on CSS-frameworks for any project I'm starting. Going forward, I'd be interested to see how framework-less sites would feel using this property. If all else fails, there's always the awesome [simple.css](https://simplecss.org/) library, which you can slap on top of a raw document to make it pretty (and dark, if preferred) without using custom classes.\r\n\r\n---\r\n\r\nThis is post 064 of [#100DaysToOffload](https://100daystooffload.com/).\n","frontmatter":{"title":"Instant dark theme","date":"2023-04-12","tags":"100DaysToOffload, guide, note, learnings, web, css, til"},"tags":["100DaysToOffload","guide","note","learnings","web","css","til"]},{"slug":"2023-03-30-designing-resilient-cloud-infrastructure","markdownBody":"\r\nAs mentioned in a [previous post](/posts/2023-03-16-terraform-project-learnings), I'm currently finishing up building my first cloud infrastructure on AWS for a client at work. During the development, I learned a lot about designing components to be resilient and scalable. Here are some key takeaways.\r\n\r\nOne of the most critical components of a resilient infrastructure is redundancy. On AWS, you place your components inside a \"region\". This could be `eu-central-1` (Frankfurt) or `us-east-1` (North Virgina), etc. To further reduce the risk of an outage, each region is divided into multiple [Availability Zones](https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Concepts.RegionsAndAvailabilityZones.html) (AZs). The AZs of a region are usually located some distance apart from each other. In case of a flood, a fire or a bomb detonating near one AZ, the other AZs should in most cases still be intact. You should have at least two, preferably three replicas of each component across multiple availability zones in a region. By having replicas of your components in different availability zones, you reduce the risk of downtime caused by an outage in a single availability zone.\r\n\r\nAnother way to ensure scalability and resilience for your database is to use [Aurora Serverless v2](https://docs.aws.amazon.com/AmazonRDS/latest/AuroraUserGuide/aurora-serverless-v2.html). This database service is specifically designed for scalable, on-demand, and cost-effective performance. The database scales itself up or down based on the workload, which allows you to automatically and dynamically adjust the database capacity to meet the demand of your application, ensuring that your application is responsive and performs well without the need for manual intervention. Adding Serverless instances to an existing RDS cluster is also a seemless proccess.\r\n\r\nIn addition to switching to Aurora Serverless v2, using read replicas for cache and database in a separate availability zone can act as a hot standby without extra configuration. Keep in mind that read replicas are only utilized by explicitly using the read-only endpoint of a cluster. But even if you're only using the \"main\" cluster endpoint (and therefore just the primary instance), a read replica can promote itself to the primary instance in case of a fail over, which drastically reduces downtime.\r\n\r\nWhen using Amazon Elastic Container Service (ECS), use Fargate as opposed to EC2 instances. Fargate is a serverless compute engine for containers that allows you to run containers without having to manage the underlying infrastructure. It smartly locates instances across availability zones, ensuring that your application is always available.\r\n\r\nIn conclusion, you should always ensure that there are more than one instance of a component in your infrastructure. There are also services on AWS that abstract away the physical infrastructure (Fargate, S3, Lambda) and use a multi-AZ pattern by default.\r\n\r\n---\r\n\r\nThis is post 061 of [#100DaysToOffload](https://100daystooffload.com/).\r\n\r\n","frontmatter":{"title":"Designing resilient cloud infrastructure","date":"2023-03-30","tags":"100DaysToOffload, infrastructure, aws, guide, note, learnings"},"tags":["100DaysToOffload","infrastructure","aws","guide","note","learnings"]},{"slug":"2023-03-16-terraform-project-learnings","markdownBody":"\r\nI just finished my first ever infrastructure project for a client. My Terraform skills are good enough to be dangerous, but during the development of this project I learned a lot that I would do differently next time.\r\n\r\n## Project structure\r\n\r\nHaving worked with semi-professional Terraform code before, I applied what I knew to my new project. That was mainly that we have a shared base and an overlay directory for each environment. I went with a single Terraform module for the shared infrastructure, and variables for each environment. Naively, roughly every service had their own file.\r\n\r\n```\r\n.\r\nâ”œâ”€â”€ modules\r\nâ”‚Â Â  â””â”€â”€ infrastructure\r\nâ”‚Â Â      â”œâ”€â”€ alb.tf\r\nâ”‚Â Â      â”œâ”€â”€ cache.tf\r\nâ”‚Â Â      â”œâ”€â”€ database.tf\r\nâ”‚Â Â      â”œâ”€â”€ dns.tf\r\nâ”‚Â Â      â”œâ”€â”€ ecr.tf\r\nâ”‚Â Â      â”œâ”€â”€ ecs.tf\r\nâ”‚Â Â      â”œâ”€â”€ iam.tf\r\nâ”‚Â Â      â”œâ”€â”€ logs.tf\r\nâ”‚Â Â      â”œâ”€â”€ main.tf\r\nâ”‚Â Â      â”œâ”€â”€ network.tf\r\nâ”‚Â Â      â”œâ”€â”€ secrets.tf\r\nâ”‚Â Â      â”œâ”€â”€ security.tf\r\nâ”‚Â Â      â”œâ”€â”€ ssl.tf\r\nâ”‚Â Â      â”œâ”€â”€ state.tf\r\nâ”‚Â Â      â””â”€â”€ variables.tf\r\nâ”œâ”€â”€ production\r\nâ”‚Â Â  â”œâ”€â”€ main.tf\r\nâ”‚Â Â  â””â”€â”€ secrets.tf\r\nâ””â”€â”€ staging\r\n    â”œâ”€â”€ main.tf\r\n    â””â”€â”€ secrets.tf\r\n```\r\n\r\nThis works very well, but I already started running into issues extending this setup. For my next project, I would probably find individual components and turn them into smaller reusable submodules. If I were to rewrite the project above, I would probably structure it like this (not a complete project, but I think you get the idea):\r\n\r\n```\r\n.\r\nâ”œâ”€â”€ modules\r\nâ”‚Â Â  â””â”€â”€ infrastructure\r\nâ”‚Â Â      â”œâ”€â”€ main.tf\r\nâ”‚Â Â      â”œâ”€â”€ modules\r\nâ”‚Â Â      â”‚Â Â  â”œâ”€â”€ database\r\nâ”‚Â Â      â”‚Â Â  â”‚Â Â  â”œâ”€â”€ iam.tf\r\nâ”‚Â Â      â”‚Â Â  â”‚Â Â  â”œâ”€â”€ logs.tf\r\nâ”‚Â Â      â”‚Â Â  â”‚Â Â  â”œâ”€â”€ main.tf\r\nâ”‚Â Â      â”‚Â Â  â”‚Â Â  â”œâ”€â”€ outputs.tf\r\nâ”‚Â Â      â”‚Â Â  â”‚Â Â  â”œâ”€â”€ rds.tf\r\nâ”‚Â Â      â”‚Â Â  â”‚Â Â  â””â”€â”€ variables.tf\r\nâ”‚Â Â      â”‚Â Â  â”œâ”€â”€ loadbalancer\r\nâ”‚Â Â      â”‚Â Â  â”‚Â Â  â”œâ”€â”€ alb.tf\r\nâ”‚Â Â      â”‚Â Â  â”‚Â Â  â”œâ”€â”€ logs.tf\r\nâ”‚Â Â      â”‚Â Â  â”‚Â Â  â”œâ”€â”€ main.tf\r\nâ”‚Â Â      â”‚Â Â  â”‚Â Â  â”œâ”€â”€ outputs.tf\r\nâ”‚Â Â      â”‚Â Â  â”‚Â Â  â””â”€â”€ variables.tf\r\nâ”‚Â Â      â”‚Â Â  â”œâ”€â”€ network\r\nâ”‚Â Â      â”‚Â Â  â”‚Â Â  â”œâ”€â”€ dns.tf\r\nâ”‚Â Â      â”‚Â Â  â”‚Â Â  â”œâ”€â”€ logs.tf\r\nâ”‚Â Â      â”‚Â Â  â”‚Â Â  â”œâ”€â”€ main.tf\r\nâ”‚Â Â      â”‚Â Â  â”‚Â Â  â”œâ”€â”€ outputs.tf\r\nâ”‚Â Â      â”‚Â Â  â”‚Â Â  â”œâ”€â”€ ssl.tf\r\nâ”‚Â Â      â”‚Â Â  â”‚Â Â  â”œâ”€â”€ variables.tf\r\nâ”‚Â Â      â”‚Â Â  â”‚Â Â  â””â”€â”€ vpc.tf\r\nâ”‚Â Â      â”‚Â Â  â”œâ”€â”€ service\r\nâ”‚Â Â      â”‚Â Â  â”‚Â Â  â”œâ”€â”€ ecr.tf\r\nâ”‚Â Â      â”‚Â Â  â”‚Â Â  â”œâ”€â”€ ecs.tf\r\nâ”‚Â Â      â”‚Â Â  â”‚Â Â  â”œâ”€â”€ iam.tf\r\nâ”‚Â Â      â”‚Â Â  â”‚Â Â  â”œâ”€â”€ logs.tf\r\nâ”‚Â Â      â”‚Â Â  â”‚Â Â  â”œâ”€â”€ main.tf\r\nâ”‚Â Â      â”‚Â Â  â”‚Â Â  â”œâ”€â”€ outputs.tf\r\nâ”‚Â Â      â”‚Â Â  â”‚Â Â  â””â”€â”€ variables.tf\r\nâ”‚Â Â      â”‚Â Â  â””â”€â”€ state\r\nâ”‚Â Â      â”‚Â Â      â”œâ”€â”€ locks.tf\r\nâ”‚Â Â      â”‚Â Â      â”œâ”€â”€ main.tf\r\nâ”‚Â Â      â”‚Â Â      â”œâ”€â”€ outputs.tf\r\nâ”‚Â Â      â”‚Â Â      â”œâ”€â”€ s3.tf\r\nâ”‚Â Â      â”‚Â Â      â””â”€â”€ variables.tf\r\nâ”‚Â Â      â”œâ”€â”€ main.tf\r\nâ”‚Â Â      â”œâ”€â”€ outputs.tf\r\nâ”‚Â Â      â””â”€â”€ variables.tf\r\nâ”œâ”€â”€ production\r\nâ”‚Â Â  â”œâ”€â”€ main.tf\r\nâ”‚Â Â  â””â”€â”€ secrets.tf\r\nâ””â”€â”€ staging\r\n    â”œâ”€â”€ main.tf\r\n    â””â”€â”€ secrets.tf\r\n```\r\n\r\n## Secrets\r\n\r\nI decided to use [git-crypt](https://github.com/AGWA/git-crypt) to manage secrets, but that was only before I learned about [SOPS](https://github.com/mozilla/sops). It's too late to migrate now, but if I could, I would choose SOPS for secrets any day of the week for upcoming projects. It even has a [Terraform provider](https://registry.terraform.io/providers/carlpett/sops/latest/docs), so there's no excuse not to use it. ;)\r\n\r\n## Conclusion\r\n\r\nOverall I'm pretty happy with how the project turned out, but there are some things that I learned during this project that will pay off later.\r\n\r\n---\r\n\r\nThis is post 057 of [#100DaysToOffload](https://100daystooffload.com/).\r\n","frontmatter":{"title":"Terraform project learnings","date":"2023-03-16","tags":"100DaysToOffload, infrastructure, aws, note, terraform, learnings"},"tags":["100DaysToOffload","infrastructure","aws","note","terraform","learnings"]}]},"__N_SSG":true}